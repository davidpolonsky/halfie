<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Half Marathon Training Tracker</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Firebase SDKs - Using compat version for better compatibility -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDrNimDjn4N4c8av7QkNQJrG-Us6JpLkMQ",
      authDomain: "halfie131.firebaseapp.com",
      projectId: "halfie131",
      storageBucket: "halfie131.firebasestorage.app",
      messagingSenderId: "3389341874",
      appId: "1:3389341874:web:a807edfd56014d5d5d49ab",
      measurementId: "G-C0ZRTWF6SP"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    // Make Firebase available globally
    window.firebaseDb = db;
    
    // Generate or retrieve user ID
    let userId = localStorage.getItem('halfie_user_id');
    if (!userId) {
      userId = 'user_' + Math.random().toString(36).substr(2, 9);
      localStorage.setItem('halfie_user_id', userId);
    }
    window.halfieUserId = userId;
    
    // Signal that Firebase is ready
    window.firebaseReady = true;
    window.dispatchEvent(new Event('firebaseReady'));
  </script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    const TrainingTracker = () => {
      const [workouts, setWorkouts] = useState([]);
      const [selectedWorkout, setSelectedWorkout] = useState(null);
      const [loading, setLoading] = useState(true);
      const [currentWeek, setCurrentWeek] = useState(1);
      const [showFullLog, setShowFullLog] = useState(false);
      const [pendingSaves, setPendingSaves] = useState({});
      const [extraActivities, setExtraActivities] = useState([]);
      const [firebaseInitialized, setFirebaseInitialized] = useState(false);

      const trainingPlan = [
        { week: 1, day: 'Tue', date: '2026-01-06', type: 'Easy Run', distance: 5, targetPace: '5:50-6:00' },
        { week: 1, day: 'Thu', date: '2026-01-08', type: 'Tempo Run', distance: 5, targetPace: '5:35-5:45' },
        { week: 1, day: 'Sat', date: '2026-01-10', type: 'Long Run', distance: 8, targetPace: '6:00-6:10' },
        { week: 2, day: 'Tue', date: '2026-01-13', type: 'Easy Run', distance: 5, targetPace: '5:50-6:00' },
        { week: 2, day: 'Thu', date: '2026-01-15', type: 'Tempo Run', distance: 6, targetPace: '5:35-5:45 (4km tempo)' },
        { week: 2, day: 'Sat', date: '2026-01-17', type: 'Long Run', distance: 10, targetPace: '6:00-6:10' },
        { week: 3, day: 'Tue', date: '2026-01-20', type: 'Easy Run', distance: 5, targetPace: '5:50-6:00' },
        { week: 3, day: 'Thu', date: '2026-01-22', type: 'Intervals', distance: 6, targetPace: '6x800m @ 5:20' },
        { week: 3, day: 'Sat', date: '2026-01-24', type: 'Long Run', distance: 12, targetPace: '6:00-6:10' },
        { week: 4, day: 'Tue', date: '2026-01-27', type: 'Easy Run', distance: 5, targetPace: '6:00-6:10' },
        { week: 4, day: 'Thu', date: '2026-01-29', type: 'Easy Run', distance: 5, targetPace: '6:00-6:10' },
        { week: 4, day: 'Sat', date: '2026-01-31', type: 'Long Run', distance: 10, targetPace: '6:10-6:20' },
        { week: 5, day: 'Tue', date: '2026-02-03', type: 'Easy Run', distance: 6, targetPace: '5:50-6:00' },
        { week: 5, day: 'Thu', date: '2026-02-05', type: 'Tempo Run', distance: 8, targetPace: '5:35-5:45 (5km tempo)' },
        { week: 5, day: 'Sat', date: '2026-02-07', type: 'Long Run', distance: 14, targetPace: '6:00-6:10' },
        { week: 6, day: 'Tue', date: '2026-02-10', type: 'Easy Run', distance: 6, targetPace: '5:50-6:00' },
        { week: 6, day: 'Thu', date: '2026-02-12', type: 'Intervals', distance: 7, targetPace: '8x800m @ 5:20' },
        { week: 6, day: 'Sat', date: '2026-02-14', type: 'Long Run', distance: 16, targetPace: '6:00-6:10' },
        { week: 7, day: 'Tue', date: '2026-02-17', type: 'Easy Run', distance: 6, targetPace: '5:50-6:00' },
        { week: 7, day: 'Thu', date: '2026-02-19', type: 'Tempo Run', distance: 10, targetPace: '5:35-5:45 (6km tempo)' },
        { week: 7, day: 'Sat', date: '2026-02-21', type: 'Long Run', distance: 18, targetPace: '6:00-6:10' },
        { week: 8, day: 'Tue', date: '2026-02-24', type: 'Easy Run', distance: 5, targetPace: '6:00-6:10' },
        { week: 8, day: 'Thu', date: '2026-02-26', type: 'Easy Run', distance: 6, targetPace: '6:00-6:10' },
        { week: 8, day: 'Sat', date: '2026-02-28', type: 'Long Run', distance: 12, targetPace: '6:10-6:20' },
        { week: 9, day: 'Tue', date: '2026-03-03', type: 'Easy Run', distance: 6, targetPace: '5:50-6:00' },
        { week: 9, day: 'Thu', date: '2026-03-05', type: 'Intervals', distance: 8, targetPace: '10x800m @ 5:20' },
        { week: 9, day: 'Sat', date: '2026-03-07', type: 'Long Run', distance: 19, targetPace: '6:00-6:10' },
        { week: 10, day: 'Tue', date: '2026-03-10', type: 'Easy Run', distance: 5, targetPace: '5:50-6:00' },
        { week: 10, day: 'Thu', date: '2026-03-12', type: 'Easy Run', distance: 5, targetPace: '5:50-6:00' },
        { week: 10, day: 'Sat', date: '2026-03-14', type: 'Cross-train', distance: 0, targetPace: 'Skiing (active recovery)' },
        { week: 10, day: 'Tue', date: '2026-03-17', type: 'Cross-train', distance: 0, targetPace: 'Skiing (active recovery)' },
        { week: 10, day: 'Thu', date: '2026-03-19', type: 'Cross-train', distance: 0, targetPace: 'Skiing (active recovery)' },
        { week: 11, day: 'Sat', date: '2026-03-21', type: 'Easy Run', distance: 6, targetPace: '6:00-6:10' },
        { week: 11, day: 'Tue', date: '2026-03-24', type: 'Easy Run', distance: 5, targetPace: '5:50-6:00' },
        { week: 11, day: 'Thu', date: '2026-03-26', type: 'Easy Run', distance: 3, targetPace: '5:45 (w/ strides)' },
        { week: 12, day: 'Sat', date: '2026-03-28', type: 'RACE DAY', distance: 21.1, targetPace: '5:41/km (sub-2hr goal)' },
      ];

      useEffect(() => {
        if (window.firebaseReady) {
          setFirebaseInitialized(true);
          loadWorkouts();
          loadExtraActivities();
        } else {
          window.addEventListener('firebaseReady', () => {
            setFirebaseInitialized(true);
            loadWorkouts();
            loadExtraActivities();
          });
        }
      }, []);

      useEffect(() => {
        const today = new Date();
        const startDate = new Date('2026-01-06');
        const diffTime = Math.abs(today - startDate);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        const calculatedWeek = Math.min(Math.ceil(diffDays / 7), 12);
        setCurrentWeek(calculatedWeek);
      }, []);

      const loadWorkouts = async () => {
        if (!window.firebaseDb) return;
        
        try {
          const loaded = [];
          for (let i = 0; i < trainingPlan.length; i++) {
            const docRef = window.firebaseDb.collection(window.halfieUserId).doc(`workout_${i}`);
            const docSnap = await docRef.get();
            
            if (docSnap.exists) {
              loaded.push(docSnap.data());
            } else {
              loaded.push({ ...trainingPlan[i], completed: false, actualDistance: '', actualPace: '', notes: '', actualDate: '' });
            }
          }
          setWorkouts(loaded);
          setLoading(false);
        } catch (error) {
          console.error('Error loading workouts:', error);
          setWorkouts(trainingPlan.map(w => ({ ...w, completed: false, actualDistance: '', actualPace: '', notes: '', actualDate: '' })));
          setLoading(false);
        }
      };

      const saveWorkout = async (index, updatedWorkout) => {
        if (!window.firebaseDb) return;
        
        try {
          const docRef = window.firebaseDb.collection(window.halfieUserId).doc(`workout_${index}`);
          await docRef.set(updatedWorkout);
          
          const newWorkouts = [...workouts];
          newWorkouts[index] = updatedWorkout;
          setWorkouts(newWorkouts);
        } catch (error) {
          console.error('Error saving workout:', error);
        }
      };

      const toggleComplete = async (index) => {
        const updated = { ...workouts[index], completed: !workouts[index].completed };
        await saveWorkout(index, updated);
      };

      const updateWorkoutDetails = async (index, field, value) => {
        const newWorkouts = [...workouts];
        newWorkouts[index] = { ...newWorkouts[index], [field]: value };
        setWorkouts(newWorkouts);
        
        if (pendingSaves[index]) {
          clearTimeout(pendingSaves[index]);
        }
        
        const timeoutId = setTimeout(async () => {
          if (!window.firebaseDb) return;
          try {
            const docRef = window.firebaseDb.collection(window.halfieUserId).doc(`workout_${index}`);
            await docRef.set(newWorkouts[index]);
          } catch (error) {
            console.error('Error saving workout:', error);
          }
        }, 500);
        
        setPendingSaves({ ...pendingSaves, [index]: timeoutId });
      };

      const loadExtraActivities = async () => {
        if (!window.firebaseDb) return;
        
        try {
          const docRef = window.firebaseDb.collection(window.halfieUserId).doc('extra_activities');
          const docSnap = await docRef.get();
          
          if (docSnap.exists) {
            setExtraActivities(docSnap.data().activities || []);
          }
        } catch (error) {
          console.error('Error loading extra activities:', error);
          setExtraActivities([]);
        }
      };

      const saveExtraActivities = async (activities) => {
        if (!window.firebaseDb) return;
        
        try {
          const docRef = window.firebaseDb.collection(window.halfieUserId).doc('extra_activities');
          await docRef.set({ activities });
          setExtraActivities(activities);
        } catch (error) {
          console.error('Error saving extra activities:', error);
        }
      };

      const addExtraActivity = async (week, type, date) => {
        const newActivity = {
          id: Date.now(),
          week,
          type,
          date,
        };
        const updated = [...extraActivities, newActivity];
        await saveExtraActivities(updated);
      };

      const deleteExtraActivity = async (id) => {
        const updated = extraActivities.filter(a => a.id !== id);
        await saveExtraActivities(updated);
      };

      const getWeekExtraActivities = (weekNum) => {
        return extraActivities.filter(a => a.week === weekNum);
      };

      const getWeekWorkouts = (weekNum) => {
        return workouts.filter(w => w.week === weekNum);
      };

      const getWeekStats = (weekNum) => {
        const weekWorkouts = getWeekWorkouts(weekNum);
        const completed = weekWorkouts.filter(w => w.completed).length;
        const total = weekWorkouts.length;
        const plannedDistance = weekWorkouts.reduce((sum, w) => sum + w.distance, 0);
        const actualDistance = weekWorkouts
          .filter(w => w.completed && w.actualDistance)
          .reduce((sum, w) => sum + parseFloat(w.actualDistance || 0), 0);
        
        return { completed, total, plannedDistance, actualDistance: actualDistance.toFixed(1) };
      };

      const formatDate = (dateStr) => {
        const [year, month, day] = dateStr.split('-').map(Number);
        const date = new Date(year, month - 1, day);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      };

      if (loading) {
        return <div className="p-8 text-center">Loading your training plan...</div>;
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
          <div className="max-w-6xl mx-auto">
            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
              <div className="flex justify-between items-start mb-4">
                <div>
                  <h1 className="text-3xl font-bold text-gray-800 mb-2">Half Marathon Training Tracker</h1>
                  <div className="flex gap-6 items-center text-gray-600">
                    <div>
                      <p className="text-lg">Race Day: <span className="font-semibold text-indigo-600">March 28, 2026</span></p>
                      <p>Goal: <span className="font-semibold">Sub-2 hours</span> (5:41/km pace)</p>
                    </div>
                    <div className="text-right">
                      <p className="text-2xl font-bold text-indigo-600">Week {currentWeek}</p>
                      <p className="text-sm">of 12</p>
                    </div>
                  </div>
                </div>
                <button
                  onClick={() => setShowFullLog(!showFullLog)}
                  className="px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
                >
                  {showFullLog ? 'Back to Weeks' : 'View Full Log'}
                </button>
              </div>
            </div>

            {!showFullLog ? (
              <>
                <div className="bg-white rounded-lg shadow-lg p-4 mb-6">
                  <div className="flex gap-2 overflow-x-auto">
                    {[...Array(12)].map((_, i) => {
                      const weekNum = i + 1;
                      const stats = getWeekStats(weekNum);
                      const isCurrentWeek = weekNum === currentWeek;
                      
                      return (
                        <button
                          key={weekNum}
                          onClick={() => setCurrentWeek(weekNum)}
                          className={`flex-shrink-0 px-4 py-2 rounded-lg font-semibold transition-colors ${
                            isCurrentWeek
                              ? 'bg-indigo-600 text-white'
                              : stats.completed === stats.total && stats.total > 0
                              ? 'bg-green-100 text-green-800 hover:bg-green-200'
                              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                          }`}
                        >
                          Week {weekNum}
                          {stats.completed > 0 && (
                            <div className="text-xs mt-1">
                              {stats.completed}/{stats.total}
                            </div>
                          )}
                        </button>
                      );
                    })}
                  </div>
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">Week {currentWeek} Summary</h2>
                  {(() => {
                    const stats = getWeekStats(currentWeek);
                    return (
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div className="bg-blue-50 p-4 rounded-lg">
                          <p className="text-sm text-gray-600">Completed</p>
                          <p className="text-2xl font-bold text-blue-600">{stats.completed}/{stats.total}</p>
                        </div>
                        <div className="bg-green-50 p-4 rounded-lg">
                          <p className="text-sm text-gray-600">Planned Distance</p>
                          <p className="text-2xl font-bold text-green-600">{stats.plannedDistance}km</p>
                        </div>
                        <div className="bg-purple-50 p-4 rounded-lg">
                          <p className="text-sm text-gray-600">Actual Distance</p>
                          <p className="text-2xl font-bold text-purple-600">{stats.actualDistance}km</p>
                        </div>
                        <div className="bg-orange-50 p-4 rounded-lg">
                          <p className="text-sm text-gray-600">Progress</p>
                          <p className="text-2xl font-bold text-orange-600">
                            {stats.total > 0 ? Math.round((stats.completed / stats.total) * 100) : 0}%
                          </p>
                        </div>
                      </div>
                    );
                  })()}
                </div>

                <div className="space-y-4">
                  {getWeekWorkouts(currentWeek).map((workout, idx) => {
                    const globalIndex = workouts.findIndex(w => 
                      w.week === workout.week && 
                      w.date === workout.date && 
                      w.type === workout.type
                    );
                    
                    return (
                      <div
                        key={globalIndex}
                        className={`bg-white rounded-lg shadow-lg p-6 transition-all ${
                          workout.completed ? 'border-l-4 border-green-500' : 'border-l-4 border-gray-300'
                        }`}
                      >
                        <div className="flex justify-between items-start mb-4">
                          <div className="flex-1">
                            <div className="flex items-center gap-3 mb-2">
                              <input
                                type="checkbox"
                                checked={workout.completed}
                                onChange={() => toggleComplete(globalIndex)}
                                className="w-6 h-6 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                              />
                              <div>
                                <h3 className="text-xl font-bold text-gray-800">{workout.type}</h3>
                                <p className="text-sm text-gray-500">{workout.day}, {formatDate(workout.date)}</p>
                              </div>
                            </div>
                          </div>
                          <button
                            onClick={() => setSelectedWorkout(selectedWorkout === globalIndex ? null : globalIndex)}
                            className="text-indigo-600 hover:text-indigo-800 font-semibold"
                          >
                            {selectedWorkout === globalIndex ? 'Close' : 'Log Details'}
                          </button>
                        </div>

                        <div className="grid grid-cols-2 gap-4 mb-4">
                          <div className="bg-gray-50 p-3 rounded">
                            <p className="text-xs text-gray-500 mb-1">Planned Distance</p>
                            <p className="font-semibold text-gray-800">{workout.distance > 0 ? `${workout.distance}km` : 'Cross-train'}</p>
                          </div>
                          <div className="bg-gray-50 p-3 rounded">
                            <p className="text-xs text-gray-500 mb-1">Target Pace</p>
                            <p className="font-semibold text-gray-800">{workout.targetPace}</p>
                          </div>
                        </div>

                        {selectedWorkout === globalIndex && (
                          <div className="border-t pt-4 space-y-3">
                            <div className="grid grid-cols-2 gap-3">
                              <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                  Actual Date (if different)
                                </label>
                                <input
                                  type="date"
                                  value={workout.actualDate || workout.date}
                                  onChange={(e) => updateWorkoutDetails(globalIndex, 'actualDate', e.target.value)}
                                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                />
                              </div>
                              <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                  Actual Distance (km)
                                </label>
                                <input
                                  type="number"
                                  step="0.01"
                                  value={workout.actualDistance}
                                  onChange={(e) => updateWorkoutDetails(globalIndex, 'actualDistance', e.target.value)}
                                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                  placeholder="5.0"
                                />
                              </div>
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                              <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                  Actual Pace (min/km)
                                </label>
                                <input
                                  type="text"
                                  value={workout.actualPace}
                                  onChange={(e) => updateWorkoutDetails(globalIndex, 'actualPace', e.target.value)}
                                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                  placeholder="5:42"
                                />
                              </div>
                              <div></div>
                            </div>
                            <div>
                              <label className="block text-sm font-medium text-gray-700 mb-1">
                                Notes
                              </label>
                              <textarea
                                value={workout.notes}
                                onChange={(e) => updateWorkoutDetails(globalIndex, 'notes', e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                rows="3"
                                placeholder="How did it feel? Weather conditions? Any observations..."
                              />
                            </div>
                            {workout.actualDistance && workout.actualPace && (
                              <div className="bg-indigo-50 p-3 rounded-lg">
                                <p className="text-sm text-indigo-800">
                                  <span className="font-semibold">Total Time:</span> {
                                    (() => {
                                      const [min, sec] = workout.actualPace.split(':').map(Number);
                                      const paceInMin = min + (sec / 60);
                                      const totalMin = paceInMin * parseFloat(workout.actualDistance);
                                      const hours = Math.floor(totalMin / 60);
                                      const minutes = Math.round(totalMin % 60);
                                      return hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
                                    })()
                                  }
                                </p>
                              </div>
                            )}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6 mt-6">
                  <h3 className="text-xl font-bold text-gray-800 mb-4">Extra Activities (Week {currentWeek})</h3>
                  
                  <div className="bg-gray-50 p-4 rounded-lg mb-4">
                    <h4 className="font-semibold text-gray-700 mb-3">Log Additional Activity</h4>
                    <div className="grid grid-cols-3 gap-3">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">
                          Activity Type
                        </label>
                        <select
                          id={`activity-type-${currentWeek}`}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                        >
                          <option value="">Select...</option>
                          <option value="Run">Run</option>
                          <option value="Basketball">Basketball</option>
                          <option value="Tennis">Tennis</option>
                          <option value="Gym">Gym</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">
                          Date
                        </label>
                        <input
                          type="date"
                          id={`activity-date-${currentWeek}`}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                        />
                      </div>
                      <div className="flex items-end">
                        <button
                          onClick={() => {
                            const typeSelect = document.getElementById(`activity-type-${currentWeek}`);
                            const dateInput = document.getElementById(`activity-date-${currentWeek}`);
                            const type = typeSelect.value;
                            const date = dateInput.value;
                            
                            if (type && date) {
                              addExtraActivity(currentWeek, type, date);
                              typeSelect.value = '';
                              dateInput.value = '';
                            } else {
                              alert('Please select an activity type and date');
                            }
                          }}
                          className="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700"
                        >
                          Add Activity
                        </button>
                      </div>
                    </div>
                  </div>

                  <div className="space-y-2">
                    {getWeekExtraActivities(currentWeek).length > 0 ? (
                      getWeekExtraActivities(currentWeek).map(activity => (
                        <div key={activity.id} className="flex justify-between items-center bg-blue-50 p-3 rounded-lg">
                          <div className="flex items-center gap-3">
                            <span className="font-semibold text-indigo-600">{activity.type}</span>
                            <span className="text-gray-600">{formatDate(activity.date)}</span>
                          </div>
                          <button
                            onClick={() => deleteExtraActivity(activity.id)}
                            className="text-red-600 hover:text-red-800 text-sm font-semibold"
                          >
                            Delete
                          </button>
                        </div>
                      ))
                    ) : (
                      <p className="text-gray-500 text-sm">No extra activities logged this week</p>
                    )}
                  </div>
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6 mt-6">
                  <h2 className="text-xl font-bold text-gray-800 mb-4">Overall Progress</h2>
                  <div className="space-y-2">
                    {(() => {
                      const totalWorkouts = workouts.length;
                      const completedWorkouts = workouts.filter(w => w.completed).length;
                      const totalPlanned = workouts.reduce((sum, w) => sum + w.distance, 0);
                      const totalActual = workouts
                        .filter(w => w.completed && w.actualDistance)
                        .reduce((sum, w) => sum + parseFloat(w.actualDistance || 0), 0);
                      
                      return (
                        <>
                          <div className="flex justify-between items-center">
                            <span className="text-gray-700">Workouts Completed</span>
                            <span className="font-bold text-indigo-600">{completedWorkouts} / {totalWorkouts}</span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-3">
                            <div
                              className="bg-indigo-600 h-3 rounded-full transition-all"
                              style={{ width: `${(completedWorkouts / totalWorkouts) * 100}%` }}
                            />
                          </div>
                          <div className="flex justify-between items-center mt-4">
                            <span className="text-gray-700">Total Distance Run</span>
                            <span className="font-bold text-green-600">{totalActual.toFixed(1)}km / {totalPlanned}km</span>
                          </div>
                        </>
                      );
                    })()}
                  </div>
                </div>
              </>
            ) : (
              <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Complete Training Log</h2>
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead>
                      <tr className="border-b-2 border-gray-300">
                        <th className="text-left py-3 px-2">Week</th>
                        <th className="text-left py-3 px-2">Planned Date</th>
                        <th className="text-left py-3 px-2">Actual Date</th>
                        <th className="text-left py-3 px-2">Type</th>
                        <th className="text-right py-3 px-2">Planned Dist</th>
                        <th className="text-right py-3 px-2">Actual Dist</th>
                        <th className="text-right py-3 px-2">Target Pace</th>
                        <th className="text-right py-3 px-2">Actual Pace</th>
                        <th className="text-right py-3 px-2">Difference</th>
                      </tr>
                    </thead>
                    <tbody>
                      {workouts.filter(w => w.completed).map((workout, idx) => {
                        const targetPaceStr = workout.targetPace.match(/\d:\d{2}/)?.[0] || '6:00';
                        const [tMin, tSec] = targetPaceStr.split(':').map(Number);
                        const targetPaceSeconds = tMin * 60 + tSec;
                        
                        let paceComparison = null;
                        if (workout.actualPace) {
                          const [aMin, aSec] = workout.actualPace.split(':').map(Number);
                          if (!isNaN(aMin) && !isNaN(aSec)) {
                            const actualPaceSeconds = aMin * 60 + aSec;
                            const diffSeconds = actualPaceSeconds - targetPaceSeconds;
                            const diffMin = Math.floor(Math.abs(diffSeconds) / 60);
                            const diffSec = Math.abs(diffSeconds) % 60;
                            const sign = diffSeconds < 0 ? '-' : '+';
                            paceComparison = {
                              text: `${sign}${diffMin}:${diffSec.toString().padStart(2, '0')}`,
                              color: diffSeconds < 0 ? 'text-green-600' : 'text-red-600'
                            };
                          }
                        }
                        
                        return (
                          <tr key={idx} className="border-b border-gray-200 hover:bg-gray-50">
                            <td className="py-3 px-2">{workout.week}</td>
                            <td className="py-3 px-2">{formatDate(workout.date)}</td>
                            <td className="py-3 px-2">{workout.actualDate ? formatDate(workout.actualDate) : '-'}</td>
                            <td className="py-3 px-2">{workout.type}</td>
                            <td className="text-right py-3 px-2">{workout.distance}km</td>
                            <td className="text-right py-3 px-2">{workout.actualDistance || '-'}km</td>
                            <td className="text-right py-3 px-2">{targetPaceStr}</td>
                            <td className="text-right py-3 px-2">{workout.actualPace || '-'}</td>
                            <td className={`text-right py-3 px-2 font-semibold ${paceComparison?.color || ''}`}>
                              {paceComparison?.text || '-'}
                            </td>
                          </tr>
                        );
                      })}
                      {extraActivities.map((activity) => (
                        <tr key={`extra-${activity.id}`} className="border-b border-gray-200 bg-blue-50">
                          <td className="py-3 px-2">{activity.week}</td>
                          <td className="py-3 px-2">-</td>
                          <td className="py-3 px-2">{formatDate(activity.date)}</td>
                          <td className="py-3 px-2 font-semibold text-indigo-600">{activity.type}</td>
                          <td className="text-right py-3 px-2">-</td>
                          <td className="text-right py-3 px-2">-</td>
                          <td className="text-right py-3 px-2">-</td>
                          <td className="text-right py-3 px-2">-</td>
                          <td className="text-right py-3 px-2">-</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                  {workouts.filter(w => w.completed).length === 0 && extraActivities.length === 0 && (
                    <div className="text-center py-8 text-gray-500">
                      No completed runs or activities yet. Start logging your workouts!
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    ReactDOM.render(<TrainingTracker />, document.getElementById('root'));
  </script>
</body>
</html>
